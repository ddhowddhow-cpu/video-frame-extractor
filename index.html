<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì˜ìƒ â†’ í”„ë ˆì„ ì¶”ì¶œê¸° (2025 í•œêµ­ ë¬´ì  ë²„ì „)</title>
<style>
  body{font-family:system-ui,sans-serif;max-width:900px;margin:40px auto;text-align:center;background:#f9f9f9;}
  h1{font-size:28px;}p{font-size:18px;color:#555;}
  .box{background:white;border-radius:20px;padding:40px;box-shadow:0 8px 30px rgba(0,0,0,0.1);margin:20px 0;}
  input,select,button{margin:15px;font-size:18px;padding:12px;}
  button{border:none;border-radius:12px;cursor:pointer;padding:16px 40px;}
  #go{background:#0d6efd;color:white;}
  #go:disabled{background:#aaa;cursor:not-allowed;}
  #zip{background:#0d9328;color:white;}
  #status{margin:20px;font-size:18px;min-height:60px;line-height:1.6;color:#333;}
  .frames{margin-top:50px;display:flex;flex-wrap:wrap;gap:20px;justify-content:center;}
  .frames img{max-width:320px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
</style>
</head>
<body>
<h1>ì˜ìƒ â†’ í”„ë ˆì„ ì¶”ì¶œê¸°</h1>
<p>ì¹´í†¡, ì¸ìŠ¤íƒ€, í‹±í†¡, ìœ íŠœë¸Œ ë‹¤ ë¨! í•œêµ­ ì–´ë””ì„œë“  ë°”ë¡œ ì‘ë™</p>

<div class="box">
  <p><strong>1. ì˜ìƒ íŒŒì¼ ì„ íƒ</strong></p>
  <input type="file" accept="video/*" id="video">
  
  <p><strong>í”„ë ˆì„ ê°„ê²©</strong></p>
  <select id="interval">
    <option value="0.5">0.5ì´ˆë§ˆë‹¤</option>
    <option value="1" selected>1ì´ˆë§ˆë‹¤ (ì¶”ì²œ)</option>
    <option value="2">2ì´ˆë§ˆë‹¤</option>
    <option value="5">5ì´ˆë§ˆë‹¤</option>
    <option value="10">10ì´ˆë§ˆë‹¤</option>
  </select>
  <br><br>
  <button id="go" disabled>í”„ë ˆì„ ì¶”ì¶œ ì‹œì‘</button>
  <div id="status">ì˜ìƒ ì„ íƒí•˜ë©´ íŒŒë€ ë²„íŠ¼ì´ í™œì„±í™”ë¼ìš”</div>
</div>

<button id="zip" disabled style="font-size:20px;padding:18px 50px;">ëª¨ë“  í”„ë ˆì„ ZIP ë‹¤ìš´ë¡œë“œ</button>
<div class="frames" id="result"></div>

<!-- 2025ë…„ 11ì›” í•œêµ­ì—ì„œ ì§„ì§œ ì•ˆ ë§‰íˆëŠ” ë§í¬ë“¤ -->
<script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/umd/ffmpeg.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.11.0/dist/umd/ffmpeg-core.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({
  log: false,
  corePath: 'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.11.0/dist/umd/ffmpeg-core.js',
});

const videoInput = document.getElementById('video');
const goBtn = document.getElementById('go');
const zipBtn = document.getElementById('zip');
const status = document.getElementById('status');
const result = document.getElementById('result');
let frames = [];

videoInput.addEventListener('change', () => {
  if (videoInput.files.length > 0) {
    goBtn.disabled = false;
    status.innerHTML = `<strong>${videoInput.files[0].name}</strong><br>íŒŒë€ ë²„íŠ¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!`;
  }
});

goBtn.addEventListener('click', async () => {
  const file = videoInput.files[0];
  goBtn.disabled = true; zipBtn.disabled = true;
  result.innerHTML = ''; frames = [];
  status.textContent = 'ffmpeg ì²˜ìŒ ë¡œë”© ì¤‘... (10~25ì´ˆ ì •ë„, í•œ ë²ˆë§Œ ê±¸ë ¤ìš”)';

  try {
    if (!ffmpeg.isLoaded()) await ffmpeg.load();
    
    status.textContent = 'ì˜ìƒ ë¶„ì„ & í”„ë ˆì„ ì¶”ì¶œ ì¤‘...';
    ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(file));
    
    const sec = document.getElementById('interval').value;
    await ffmpeg.run('-i', 'input.mp4', '-vf', `fps=1/${sec}`, '-q:v', '2', 'frame_%05d.jpg');
    
    const files = ffmpeg.FS('readdir', '.').filter(f => f.startsWith('frame_'));
    
    for (const f of files) {
      const data = ffmpeg.FS('readFile', f);
      const blob = new Blob([data.buffer], {type: 'image/jpeg'});
      frames.push(blob);
      
      const img = new Image();
      img.src = URL.createObjectURL(blob);
      img.loading = "lazy";
      result.appendChild(img);
    }
    
    status.textContent = `ì™„ë£Œ! ${files.length}ì¥ ì¶”ì¶œë¨ ğŸ‰`;
    zipBtn.disabled = false;
  } catch (e) {
    status.textContent = `ì˜¤ë¥˜: ${e.message}`;
    console.error(e);
  }
  goBtn.disabled = false;
});

zipBtn.addEventListener('click', async () => {
  zipBtn.disabled = true;
  status.textContent = 'ZIP ë§Œë“œëŠ” ì¤‘...';
  const zip = new JSZip();
  frames.forEach((blob, i) => {
    zip.file(`í”„ë ˆì„_${String(i+1).padStart(4,'0')}.jpg`, blob);
  });
  const blob = await zip.generateAsync({type:'blob'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'í”„ë ˆì„_ì „ì²´.zip';
  a.click();
  status.textContent = 'ZIP ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!';
  zipBtn.disabled = false;
});
</script>
</body>
</html>
