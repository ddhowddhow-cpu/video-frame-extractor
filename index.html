<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ìƒ â†’ ì´ë¯¸ì§€ í”„ë ˆì„ ì¶”ì¶œê¸° (ë¸Œë¼ìš°ì € ë²„ì „)</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 960px;
      margin: 40px auto;
      padding: 0 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    .desc {
      text-align: center;
      color: #666;
      margin-bottom: 24px;
      font-size: 14px;
      line-height: 1.4;
    }
    .upload-box {
      border: 2px dashed #ccc;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
    }
    .upload-box input[type="file"] {
      margin-top: 8px;
    }
    button {
      margin-top: 16px;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
    }
    #status {
      margin-top: 12px;
      text-align: center;
      font-size: 14px;
      color: #444;
      white-space: pre-line;
    }
    .frames {
      margin-top: 32px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .frames img {
      width: 220px;
      border-radius: 8px;
      border: 1px solid #ddd;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <h1>ğŸ¬ ì˜ìƒ â†’ ğŸ–¼ ì´ë¯¸ì§€ í”„ë ˆì„ ì¶”ì¶œ (ffmpeg.wasm)</h1>
  <div class="desc">
    ì˜ìƒ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´, ë¸Œë¼ìš°ì € ì•ˆì—ì„œ ffmpegë¡œ í”„ë ˆì„ì„ ì¶”ì¶œí•´ ë°”ë¡œ ì•„ë˜ì— ë³´ì—¬ì¤ë‹ˆë‹¤.<br>
    (íŒŒì¼ì€ ì„œë²„ë¡œ ì—…ë¡œë“œë˜ì§€ ì•Šê³ , ê°ì PC ë¸Œë¼ìš°ì € ì•ˆì—ì„œë§Œ ì²˜ë¦¬ë¼ìš”.)
  </div>

  <div class="upload-box">
    <div>1. ì˜ìƒ íŒŒì¼ ì„ íƒ (mp4, mov ë“±)</div>
    <input id="videoInput" type="file" accept="video/*" />
    <div>2. ì•„ë˜ ë²„íŠ¼ í´ë¦­í•´ì„œ í”„ë ˆì„ ì¶”ì¶œ</div>
    <button id="extractBtn" disabled>í”„ë ˆì„ ì¶”ì¶œí•˜ê¸°</button>
    <div id="status"></div>
  </div>

  <div id="frames" class="frames"></div>

  <!-- ffmpeg.wasm ë¡œë“œ (CDN) -->
  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/ffmpeg.min.js"></script>
  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;

    const videoInput = document.getElementById('videoInput');
    const extractBtn = document.getElementById('extractBtn');
    const statusEl = document.getElementById('status');
    const framesEl = document.getElementById('frames');

    let ffmpeg = null;
    let selectedFile = null;

    // íŒŒì¼ ì„ íƒë˜ë©´ ë²„íŠ¼ í™œì„±í™”
    videoInput.addEventListener('change', (e) => {
      selectedFile = e.target.files[0];
      if (selectedFile) {
        extractBtn.disabled = false;
        statusEl.textContent = `ì„ íƒëœ íŒŒì¼: ${selectedFile.name}`;
      } else {
        extractBtn.disabled = true;
        statusEl.textContent = '';
      }
    });

    async function initFFmpeg() {
      if (!ffmpeg) {
        ffmpeg = createFFmpeg({
          corePath: 'https://unpkg.com/@ffmpeg/core@0.12.10/dist/ffmpeg-core.js',
          log: true,
        });
      }
      if (!ffmpeg.isLoaded()) {
        statusEl.textContent = 'ffmpeg ë¡œë”© ì¤‘ì…ë‹ˆë‹¤... (ì²˜ìŒ í•œ ë²ˆë§Œ ì¢€ ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤)';
        await ffmpeg.load();
      }
    }

    extractBtn.addEventListener('click', async () => {
      if (!selectedFile) {
        alert('ë¨¼ì € ì˜ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
        return;
      }

      extractBtn.disabled = true;
      framesEl.innerHTML = '';
      statusEl.textContent = 'ì¤€ë¹„ ì¤‘...';

      try {
        // ffmpeg ë¡œë“œ
        await initFFmpeg();

        // ê°€ìƒ íŒŒì¼ì‹œìŠ¤í…œì— ì˜ìƒ ì“°ê¸°
        const inputName = 'input_video' + (selectedFile.name.split('.').pop() || 'mp4');
        ffmpeg.FS('writeFile', inputName, await fetchFile(selectedFile));

        statusEl.textContent = 'í”„ë ˆì„ ì¶”ì¶œ ì¤‘ì…ë‹ˆë‹¤...\nì˜ìƒ ê¸¸ì´ì— ë”°ë¼ ì‹œê°„ì´ ì¡°ê¸ˆ ê±¸ë¦´ ìˆ˜ ìˆì–´ìš”.';

        // fps=1 ì´ë©´ 1ì´ˆì— í•œ ì¥ì”©, fps=0.5 ì´ë©´ 2ì´ˆì— í•œ ì¥ (ì›í•˜ëŠ”ëŒ€ë¡œ ì¡°ì ˆ ê°€ëŠ¥)
        // frame_%03d.jpg í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
        await ffmpeg.run(
          '-i', inputName,
          '-vf', 'fps=1',
          'frame_%03d.jpg'
        );

        statusEl.textContent = 'ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';

        // ffmpeg FS ì— ì €ì¥ëœ frame_001.jpg, frame_002.jpg ... ì°¾ê¸°
        let index = 1;
        let found = 0;

        while (true) {
          const filename = `frame_${String(index).padStart(3, '0')}.jpg`;
          try {
            const data = ffmpeg.FS('readFile', filename);
            const blob = new Blob([data.buffer], { type: 'image/jpeg' });
            const url = URL.createObjectURL(blob);

            const img = document.createElement('img');
            img.src = url;
            framesEl.appendChild(img);

            found++;
            index++;
          } catch (err) {
            // ë” ì´ìƒ íŒŒì¼ì´ ì—†ìœ¼ë©´ ì¢…ë£Œ
            break;
          }
        }

        if (found === 0) {
          statusEl.textContent = 'ì¶”ì¶œëœ í”„ë ˆì„ì´ ì—†ìŠµë‹ˆë‹¤. (ì˜ìƒ í¬ë§· ë¬¸ì œì¼ ìˆ˜ ìˆì–´ìš”)';
        } else {
          statusEl.textContent = `âœ… í”„ë ˆì„ ${found}ì¥ì´ ì¶”ì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ì—ì„œ í™•ì¸í•˜ì„¸ìš”.`;
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err;
      } finally {
        extractBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
