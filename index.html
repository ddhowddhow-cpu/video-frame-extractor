<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì˜ìƒ â†’ í”„ë ˆì„ ì¶”ì¶œê¸°</title>
  <style>
    body {font-family: system-ui,sans-serif; max-width:900px; margin:40px auto; text-align:center; background:#f9f9f9;}
    h1 {font-size:28px;}
    .box {background:white; border-radius:20px; padding:40px; box-shadow:0 8px 30px rgba(0,0,0,0.1);}
    input, select, button {margin:15px; font-size:17px;}
    button {padding:16px 40px; border:none; border-radius:12px; cursor:pointer;}
    #go {background:#0d6efd; color:white;}
    #go:disabled {background:#aaa; cursor:not-allowed;}
    #zip {background:#0d9328; color:white;}
    #status {margin:20px; font-size:17px; min-height:60px; line-height:1.6;}
    .frames {margin-top:50px; display:flex; flex-wrap:wrap; gap:20px; justify-content:center;}
    .frames img {max-width:320px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.1);}
  </style>
</head>
<body>
  <h1>ì˜ìƒ â†’ í”„ë ˆì„ ì¶”ì¶œê¸°</h1>
  <p>ì¹´í†¡ ë™ì˜ìƒë„ ë°”ë¡œ í”„ë ˆì„ìœ¼ë¡œ!</p>

  <div class="box">
    <p><strong>1. ì˜ìƒ íŒŒì¼ ì„ íƒ</strong></p>
    <input type="file" accept="video/*" id="video">

    <p><strong>í”„ë ˆì„ ê°„ê²©</strong></p>
    <select id="interval">
      <option value="0.5">0.5ì´ˆ</option>
      <option value="1" selected>1ì´ˆ (ì¶”ì²œ)</option>
      <option value="2">2ì´ˆ</option>
      <option value="5">5ì´ˆ</option>
    </select>

    <br><br>
    <button id="go" disabled>í”„ë ˆì„ ì¶”ì¶œ ì‹œì‘</button>
    <div id="status">íŒŒì¼ ì„ íƒ â†’ íŒŒë€ ë²„íŠ¼ í™œì„±í™” â†’ í´ë¦­!</div>
  </div>

  <button id="zip" disabled>ëª¨ë“  í”„ë ˆì„ ZIP ë‹¤ìš´ë¡œë“œ</button>
  <div class="frames" id="result"></div>

  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({
      log: false,
      corePath: 'https://ddhowddhow-cpu.github.io/video-frame-extractor/ffmpeg-core.js',
      wasmPath: 'https://ddhowddhow-cpu.github.io/video-frame-extractor/ffmpeg-core.wasm'
    });

    const videoInput = document.getElementById('video');
    const goBtn = document.getElementById('go');
    const zipBtn = document.getElementById('zip');
    const status = document.getElementById('status');
    const result = document.getElementById('result');
    let frames = [];

    videoInput.addEventListener('change', () => {
      if (videoInput.files[0]) {
        goBtn.disabled = false;
        status.innerHTML = `<strong>${videoInput.files[0].name}</strong><br>íŒŒë€ ë²„íŠ¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!`;
      }
    });

    goBtn.addEventListener('click', async () => {
      const file = videoInput.files[0];
      if (!file) return;

      goBtn.disabled = true;
      zipBtn.disabled = true;
      result.innerHTML = '';
      frames = [];
      status.textContent = 'ffmpeg ë¡œë”© ì¤‘... (20~40ì´ˆ)';

      try {
        if (!ffmpeg.isLoaded()) await ffmpeg.load();

        status.textContent = 'í”„ë ˆì„ ì¶”ì¶œ ì¤‘...';
        ffmpeg.FS('writeFile', 'input', await fetchFile(file));

        const sec = document.getElementById('interval').value;
        await ffmpeg.run('-i', 'input', '-vf', `fps=1/${sec}`, '-q:v', '2', 'frame_%05d.jpg');

        const files = ffmpeg.FS('readdir', '.').filter(f => f.startsWith('frame_'));
        files.forEach(f => {
          const data = ffmpeg.FS('readFile', f);
          const blob = new Blob([data], {type: 'image/jpeg'});
          frames.push({name: f, blob});
          const img = new Image();
          img.src = URL.createObjectURL(blob);
          result.appendChild(img);
        });

        status.textContent = `ì™„ë£Œ! ${files.length}ì¥ ì¶”ì¶œë¨ ğŸ‰`;
        zipBtn.disabled = false;
      } catch (e) {
        status.textContent = `ì‹¤íŒ¨: ${e.message}`;
      }
      goBtn.disabled = false;
    });

    zipBtn.addEventListener('click', async () => {
      zipBtn.disabled = true;
      status.textContent = 'ZIP ë§Œë“œëŠ” ì¤‘...';
      const zip = new JSZip();
      frames.forEach((f,i) => zip.file(`frame_${String(i+1).padStart(5,'0')}.jpg`, f.blob));
      const blob = await zip.generateAsync({type:'blob'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'frames.zip';
      a.click();
      status.textContent = 'ZIP ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!';
      zipBtn.disabled = false;
    });
  </script>
</body>
</html>
