<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì˜ìƒ â†’ ì´ë¯¸ì§€ í”„ë ˆì„ ì¶”ì¶œ</title>
  <style>
    body {font-family: system-ui, sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; line-height: 1.6;}
    h1 {text-align: center;}
    .box {border: 2px dashed #ddd; border-radius: 16px; padding: 30px; text-align: center; background: #f9f9f9;}
    input, select, button {margin: 10px 0; font-size: 16px;}
    button {padding: 14px 32px; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer;}
    button:disabled {background: #ccc; cursor: not-allowed;}
    #status {margin-top: 15px; min-height: 50px; font-size: 15px;}
    .frames {margin-top: 40px; display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;}
    .frames img {max-width: 300px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);}
  </style>
</head>
<body>
  <h1>ğŸ¬ ì˜ìƒ â†’ ğŸ–¼ í”„ë ˆì„ ì¶”ì¶œ (100% ë¸Œë¼ìš°ì €ì—ì„œë§Œ)</h1>
  <div class="box">
    <p><strong>1. ì˜ìƒ íŒŒì¼ ì„ íƒ</strong></p>
    <input type="file" accept="video/*" id="video">

    <p><strong>í”„ë ˆì„ ê°„ê²©</strong></p>
    <select id="sec">
      <option value="0.5">0.5ì´ˆ</option>
      <option value="1" selected>1ì´ˆ</option>
      <option value="2">2ì´ˆ</option>
      <option value="3">3ì´ˆ</option>
      <option value="5">5ì´ˆ</option>
    </select>

    <p><button id="start" disabled>í”„ë ˆì„ ì¶”ì¶œ ì‹œì‘</button></p>
    <div id="status">íŒŒì¼ì„ ì„ íƒí•˜ë©´ ë²„íŠ¼ì´ í™œì„±í™”ë¼ìš” â†’</div>
  </div>

  <p style="text-align:center; margin-top:20px;">
    <button id="zip" disabled style="padding:12px 24px; background:#28a745;">ğŸ“¦ ëª¨ë“  í”„ë ˆì„ ZIPìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ</button>
  </p>

  <div class="frames" id="result"></div>

  <!-- í•œêµ­ì—ì„œ ì œì¼ ì˜ ë˜ëŠ” ì„¤ì • -->
  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/umd/ffmpeg.min.js"></script>
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>

  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({
      corePath: 'https://unpkg.com/@ffmpeg/core@0.12.6/ffmpeg-core.js',
      log: false
    });

    const video = document.getElementById('video');
    const start = document.getElementById('start');
    const status = document.getElementById('status');
    const result = document.getElementById('result');
    const zipBtn = document.getElementById('zip');
    let frames = [];

    video.onchange = () => {
      if (video.files.length > 0) {
        start.disabled = false;
        status.textContent = `${video.files[0].name} ì„ íƒë¨ â†’ ì¶”ì¶œ ì‹œì‘ ë²„íŠ¼ ëˆŒëŸ¬ì£¼ì„¸ìš”`;
      }
    };

    start.onclick = async () => {
      const file = video.files[0];
      if (!file) return;

      start.disabled = true;
      zipBtn.disabled = true;
      result.innerHTML = '';
      frames = [];
      status.textContent = 'ffmpeg ë¡œë”© ì¤‘... (ìµœì´ˆ 20~60ì´ˆ ê±¸ë ¤ìš”)';

      if (!ffmpeg.isLoaded()) await ffmpeg.load();

      status.textContent = 'í”„ë ˆì„ ì¶”ì¶œ ì¤‘...';
      ffmpeg.FS('writeFile', 'in', await fetchFile(file));

      const interval = document.getElementById('sec').value;
      await ffmpeg.run('-i', 'in', '-vf', `fps=1/${interval}`, '-q:v', '2', 'f_%05d.jpg');

      const files = ffmpeg.FS('readdir', '.').filter(f => f.startsWith('f_'));
      for (const f of files) {
        const data = ffmpeg.FS('readFile', f);
        frames.push({name: f, data});
        const url = URL.createObjectURL(new Blob([data], {type: 'image/jpeg'}));
        const img = new Image();
        img.src = url;
        img.style.maxWidth = '100%';
        result.appendChild(img);
      }

      status.textContent = `ì™„ë£Œ! ${files.length}ì¥ ì¶”ì¶œë¨`;
      zipBtn.disabled = false;
      start.disabled = false;
    };

    zipBtn.onclick = async () => {
      zipBtn.disabled = true;
      status.textContent = 'ZIP ë§Œë“œëŠ” ì¤‘...';
      const zip = new JSZip();
      frames.forEach(f => zip.file(f.name, f.data));
      const blob = await zip.generateAsync({type: 'blob'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'í”„ë ˆì„ë“¤.zip';
      a.click();
      status.textContent = 'ZIP ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!';
      zipBtn.disabled = false;
    };
  </script>
</body>
</html>
