<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì˜ìƒ â†’ í”„ë ˆì„ ì¶”ì¶œ (í•œêµ­ ì–´ë””ì„œë‚˜ ë¨)</title>
  <style>
    body {font-family: system-ui,sans-serif; max-width:960px; margin:40px auto; padding:20px; text-align:center;}
    h1 {margin-bottom:10px;}
    .box {border:2px dashed #ddd; border-radius:16px; padding:30px; background:#fafafa;}
    input, select {margin:10px; font-size:16px;}
    button {padding:14px 32px; background:#0069d9; color:white; border:none; border exit; border-radius:8px; font-size:16px; cursor:pointer;}
    button:disabled {background:#aaa; cursor:not-allowed;}
    #status {margin-top:20px; min-height:60px; font-size:15px; line-height:1.5;}
    .frames {margin-top:40px; display:flex; flex-wrap:wrap; gap:15px; justify-content:center;}
    .frames img {max-width:300px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
  </style>
</head>
<body>
  <h1>ğŸ¬ ì˜ìƒ â†’ ğŸ–¼ í”„ë ˆì„ ì¶”ì¶œê¸°</h1>
  <p>íŒŒì¼ì€ ì„œë²„ë¡œ ì•ˆ ì˜¬ë¼ê°€ìš”. 100% ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì²˜ë¦¬!</p>

  <div class="box">
    <p><strong>1. ì˜ìƒ ì„ íƒ</strong></p>
    <input type="file" accept="video/*" id="file">

    <p><strong>ê°„ê²©</strong></p>
    <select id="interval">
      <option value="0.5">0.5ì´ˆ</option>
      <option value="1" selected>1ì´ˆ</option>
      <option value="2">2ì´ˆ</option>
      <option value="5">5ì´ˆ</option>
    </select><br>

    <button id="go">í”„ë ˆì„ ì¶”ì¶œ ì‹œì‘</button>
    <div id="status">íŒŒì¼ ì„ íƒí•˜ë©´ ë²„íŠ¼ í™œì„±í™” â†’ í´ë¦­í•˜ì„¸ìš”</div>
  </div>

  <p><button id="zip" disabled style="background:#28a745; padding:12px 24px; margin-top:20px;">ğŸ“¦ ZIPìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ</button></p>

  <div class="frames" id="output"></div>

  <!-- í•œêµ­ ìµœì í™”ëœ CDN (unpkgê°€ ì œì¼ ì˜ ëš«ë¦¼) -->
  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/umd/ffmpeg.min.js"></script>
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>

  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ 
      log: false,
      corePath: 'https://unpkg.com/@ffmpeg/core@0.12.6/ffmpeg-core.js'
    });

    const fileInput = document.getElementById('file');
    const goBtn = document.getElementById('go');
    const status = document.getElementById('status');
    const output = document.getElementById('output');
    const zipBtn = document.getElementById('zip');
    let frames = [];

    // íŒŒì¼ ì„ íƒí•˜ë©´ ë²„íŠ¼ ë°”ë¡œ í™œì„±í™” (ì´ê²Œ í•µì‹¬!)
    fileInput.addEventListener('change', () => {
      if (fileInput.files.length > 0) {
        goBtn.disabled = false;
        status.textContent = `${fileInput.files[0].name} ì„ íƒë¨ â€” ì¶”ì¶œ ì‹œì‘ ë²„íŠ¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!`;
      }
    });

    goBtn.addEventListener('click', async () => {
      const vidFile = fileInput.files[0];
      if (!vidFile) return;

      goBtn.disabled = true;
      zipBtn.disabled = true;
      output.innerHTML = '';
      frames = [];
      status.textContent = 'ffmpeg.wasm ë¡œë”© ì¤‘... (ìµœì´ˆ 20~60ì´ˆ, ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)';

      try {
        if (!ffmpeg.isLoaded()) await ffmpeg.load();

        status.textContent = 'í”„ë ˆì„ ì¶”ì¶œ ì¤‘...';
        ffmpeg.FS('writeFile', 'video', await fetchFile(vidFile));

        const sec = document.getElementById('interval').value;
        await ffmpeg.run('-i', 'video', '-vf', `fps=1/${sec}`, '-q:v', '2', 'frame_%05d.jpg');

        const list = ffmpeg.FS('readdir', '.').filter(f => f.startsWith('frame_'));
        list.forEach(f => {
          const data = ffmpeg.FS('readFile', f);
          frames.push({name: f, blob: new Blob([data], {type: 'image/jpeg'})});
          const img = new Image();
          img.src = URL.createObjectURL(frames[frames.length-1].blob);
          output.appendChild(img);
        });

        status.textContent = `ì™„ë£Œ! ${list.length}ì¥ ì¶”ì¶œë¨`;
        zipBtn.disabled = false;
      } catch (e) {
        status.textContent = 'ì˜¤ë¥˜: ' + e.message + '\nê´‘ê³ ì°¨ë‹¨ê¸° ë„ê³  Ctrl+F5 ëˆŒëŸ¬ë³´ì„¸ìš”';
      }
      goBtn.disabled = false;
    });

    zipBtn.addEventListener('click', async () => {
      zipBtn.disabled = true;
      status.textContent = 'ZIP ë§Œë“œëŠ” ì¤‘...';
      const zip = new JSZip();
      frames.forEach((f, i) => zip.file(f.name, f.blob));
      const blob = await zip.generateAsync({type:'blob'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'frames.zip';
      a.click();
      status.textContent = 'ZIP ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!';
      zipBtn.disabled = false;
    });
  </script>
</body>
</html>
