<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ìƒ â†’ ì´ë¯¸ì§€ í”„ë ˆì„ ì¶”ì¶œê¸°</title>
  <style>
    body {font-family: system-ui, sans-serif; max-width: 960px; margin: 40px auto; padding: 0 20px;}
    h1 {text-align: center;}
    .desc {text-align: center; color: #666; margin-bottom: 24px; font-size: 14px;}
    .upload-box {border: 2px dashed #ccc; border-radius: 12px; padding: 24px; text-align: center;}
    button {margin-top: 16px; padding: 12px 24px; background:#007bff; color:white; border:none; border-radius:8px; cursor:pointer;}
    button:disabled {background:#999; cursor:default;}
    #status {margin-top: 12px; text-align: center; white-space: pre-line; color:#444;}
    .frames {margin-top: 32px; display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;}
    .frames img {width: 240px; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
    .download-box {text-align:center; margin-top:20px;}
  </style>
</head>
<body>
  <h1>ğŸ¬ ì˜ìƒ â†’ ğŸ–¼ í”„ë ˆì„ ì¶”ì¶œ (ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì‹¤í–‰)</h1>
  <div class="desc">íŒŒì¼ì€ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•Šì•„ìš”. 100% ë¸Œë¼ìš°ì € ì•ˆì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤!</div>

  <div class="upload-box">
    <div>1. ì˜ìƒ ì„ íƒ (mp4, mov, webm ë“±)</div>
    <input id="videoInput" type="file" accept="video/*" style="margin:10px 0;">

    <div>í”„ë ˆì„ ê°„ê²©:
      <select id="intervalSelect">
        <option value="0.5">0.5ì´ˆ</option>
        <option value="1" selected>1ì´ˆ</option>
        <option value="2">2ì´ˆ</option>
        <option value="3">3ì´ˆ</option>
        <option value="5">5ì´ˆ</option>
        <option value="10">10ì´ˆ</option>
      </select>
    </div>

    <button id="extractBtn">í”„ë ˆì„ ì¶”ì¶œ ì‹œì‘</button>
    <div id="status"></div>
  </div>

  <div class="download-box">
    <button id="downloadZipBtn" disabled style="padding:10px 20px;">ğŸ“¦ ëª¨ë“  í”„ë ˆì„ ZIP ë‹¤ìš´ë¡œë“œ</button>
  </div>

  <div id="frames" class="frames"></div>

  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.10/dist/umd/ffmpeg.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({
      corePath: 'https://unpkg.com/@ffmpeg/core@0.12.6/ffmpeg-core.js',
      wasmPath: 'https://unpkg.com/@ffmpeg/core@0.12.6/ffmpeg-core.wasm',
      workerPath: 'https://unpkg.com/@ffmpeg/core@0.12.6/ffmpeg-core.worker.js',
      log: false
    });

    let loaded = false;
    const statusEl = document.getElementById('status');
    const extractBtn = document.getElementById('extractBtn');
    const downloadZipBtn = document.getElementById('downloadZipBtn');
    const framesEl = document.getElementById('frames');
    let framesData = [];

    document.getElementById('videoInput').addEventListener('change', e => {
      if (e.target.files[0]) {
        extractBtn.disabled = false;
        statusEl.textContent = `ì„ íƒë¨: ${e.target.files[0].name}`;
      }
    });

    async function load() {
      if (loaded) return;
      statusEl.textContent = 'ffmpeg.wasm ë¡œë”© ì¤‘... (ìµœì´ˆ 30~60ì´ˆ)';
      await ffmpeg.load();
      loaded = true;
      statusEl.textContent = 'ë¡œë”© ì™„ë£Œ! ì¶”ì¶œ ì‹œì‘ ë²„íŠ¼ ëˆŒëŸ¬ì£¼ì„¸ìš”';
    }

    extractBtn.onclick = async () => {
      const file = document.getElementById('videoInput').files[0];
      if (!file) return;

      extractBtn.disabled = true;
      framesEl.innerHTML = '';
      framesData = [];
      await load();

      statusEl.textContent = 'í”„ë ˆì„ ì¶”ì¶œ ì¤‘...';
      ffmpeg.FS('writeFile', 'input', await fetchFile(file));

      const interval = document.getElementById('intervalSelect').value;
      await ffmpeg.run('-i', 'input', '-vf', `fps=1/${interval}`, '-q:v', '3', 'out_%04d.jpg');

      const files = ffmpeg.FS('readdir', '.').filter(f => f.startsWith('out_'));
      for (const f of files) {
        const data = ffmpeg.FS('readFile', f);
        framesData.push({name: f, data});
        const url = URL.createObjectURL(new Blob([data], {type: 'image/jpeg'}));
        const img = new Image();
        img.src = url;
        framesEl.appendChild(img);
      }

      statusEl.textContent = `ì™„ë£Œ! ${files.length}ì¥ ì¶”ì¶œë¨`;
      downloadZipBtn.disabled = false;
      extractBtn.disabled = false;
    };

    downloadZipBtn.onclick = async () => {
      downloadZipBtn.disabled = true;
      statusEl.textContent = 'ZIP ë§Œë“œëŠ” ì¤‘...';
      const zip = new JSZip();
      framesData.forEach(f => zip.file(f.name, f.data));
      const blob = await zip.generateAsync({type: 'blob'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'frames.zip';
      a.click();
      statusEl.textContent = 'ZIP ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!';
      downloadZipBtn.disabled = false;
    };
  </script>
</body>
</html>
